#Si hay duplicados los eliminamos con la función de dplyr
data <- data %>%
distinct()
#Añadimos una columna con el precio total de cada venta:
data <- data %>% mutate(lineTotal = Quantity * UnitPrice)
#Añadimos una columna con el dia de la semana
data$weekDay <- wday(data$ParsedDate, label=TRUE)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
revalue(data$weekDay, c("mi\\."="Miercoles", "ju\\."="Jueves", "vi\\."="Viernes", "do\\."="Domingo", "lu\\."="Lunes", "ma\\."="Martes"))
View(data)
View(data)
view(data)
View(data)
View(data)
class(data$weekDay)
unique(data$weekDay)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
revalue(data$weekDay, c("mi\\."="Miercoles", "ju\\."="Jueves", "vi\\."="Viernes", "do\\."="Domingo", "lu\\."="Lunes", "ma\\."="Martes"))
unique(data$weekDay)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
data$weekDay <- revalue(data$weekDay, c("mi\\."="Miercoles", "ju\\."="Jueves", "vi\\."="Viernes", "do\\."="Domingo", "lu\\."="Lunes", "ma\\."="Martes"))
View(data)
View(data)
data$weekDay <- wday(data$ParsedDate, label=TRUE)
data %>%
group_by(weekDay) %>%
summarise(revenue = sum(lineTotal)) %>%
ggplot(aes(x = weekDay, y = revenue)) + geom_col() + labs(x = 'Dia de la semana', y = 'Beneficio (£)', title = 'Beneficio por dia de la semana')
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(tidyverse)
library(lubridate)
#Cargamos los datos:
data <- read.csv("data.csv")
class(data$InvoiceDate)
#A priori parace que solo tenemos problemas con la fecha de la factura que es leída como un string
data <- data %>%
mutate(
ParsedDate = parse_datetime(InvoiceDate, format = "%m/%d/%Y %H:%M")
)
#Comprobamos que no haya NA en el fichero
anyNA(data) #Tenemos NA
summary(data) #Solo hay NA's en CustomerID
#Borramos todos los precios y cantidades negativas
data <- data %>%
mutate(Quantity = replace(Quantity, Quantity<=0, NA),
UnitPrice = replace(UnitPrice, UnitPrice<=0, NA))
#Borramos los NA
data <- data %>%
drop_na()
#Sustituimos los NA por 0, son 135080 observaciones que pueden contener información interesante
#data$CustomerID <- ifelse(is.na(data$CustomerID)== TRUE,0,data$CustomerID)
#Si hay duplicados los eliminamos con la función de dplyr
data <- data %>%
distinct()
#Añadimos una columna con el precio total de cada venta:
data <- data %>% mutate(lineTotal = Quantity * UnitPrice)
#Añadimos una columna con el dia de la semana
data$weekDay <- wday(data$ParsedDate, label=TRUE)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
data$weekDay <- revalue(data$weekDay, c("mi\\."="Miercoles", "ju\\."="Jueves", "vi\\."="Viernes", "do\\."="Domingo", "lu\\."="Lunes", "ma\\."="Martes"))
data %>%
group_by(StockCode) %>%
summarise(count = n(),
sum_quantity = sum(Quantity),
mean_quantity = round(mean(Quantity), 2),
median_quantity = median(Quantity),
mode_quantity = unique(Quantity)[which.max(tabulate(match(Quantity, unique(Quantity))))],
sd_quantity = round(sd(Quantity), 2))
#Tenemos muchos productos que se han vendido solo una vez
sum(sales$Total == 1) #En concreto 52
View(data)
View(data)
data %>%
group_by(StockCode) %>%
summarise(count = n(),
sum_quantity = sum(Quantity),
mean_quantity = round(mean(Quantity), 2),
median_quantity = median(Quantity),
mode_quantity = unique(Quantity)[which.max(tabulate(match(Quantity, unique(Quantity))))],
sd_quantity = round(sd(Quantity), 2))
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
group_by(StockCode) %>%
summarise(Total = sum(Quantity))
#Ordenamos de mayor a menor
sales <- sales[
with(sales, order(-Total)),
]
sales %>% top_n(10) %>%
ggplot(aes(x = StockCode, y = Total)) +
geom_col() +
labs(x = 'Código Stock', y = 'Cantidad', title = 'Cantidad vendida de los top 10')
View(data)
View(data)
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
select(StockCode,Quantity) %>%
group_by(StockCode) %>%
summarise(Total = sum(Quantity))
View(sales)
View(sales)
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
select(StockCode,Quantity) %>%
summarise(Total = sum(Quantity))
View(sales)
View(sales)
#Tenemos muchos productos que se han vendido solo una vez
sum(sales$Total == 1) #En concreto 52
#Quizás lo mejor sería eliminar estos productos del Stock
data$weekDay <- wday(data$ParsedDate, label=TRUE)
data %>%
group_by(weekDay) %>%
summarise(revenue = sum(lineTotal)) %>%
ggplot(aes(x = weekDay, y = revenue)) + geom_col() + labs(x = 'Dia de la semana', y = 'Beneficio (£)', title = 'Beneficio por dia de la semana')
data$weekDay
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
#Cargamos los datos:
data <- read.csv("data.csv")
class(data$InvoiceDate)
#A priori parace que solo tenemos problemas con la fecha de la factura que es leída como un string
data <- data %>%
mutate(
ParsedDate = parse_datetime(InvoiceDate, format = "%m/%d/%Y %H:%M")
)
#Comprobamos que no haya NA en el fichero
anyNA(data) #Tenemos NA
summary(data) #Solo hay NA's en CustomerID
#Borramos todos los precios y cantidades negativas
data <- data %>%
mutate(Quantity = replace(Quantity, Quantity<=0, NA),
UnitPrice = replace(UnitPrice, UnitPrice<=0, NA))
#Borramos los NA
data <- data %>%
drop_na()
#Sustituimos los NA por 0, son 135080 observaciones que pueden contener información interesante
#data$CustomerID <- ifelse(is.na(data$CustomerID)== TRUE,0,data$CustomerID)
#Si hay duplicados los eliminamos con la función de dplyr
data <- data %>%
distinct()
#Añadimos una columna con el precio total de cada venta:
data <- data %>% mutate(lineTotal = Quantity * UnitPrice)
#Añadimos una columna con el dia de la semana
data$weekDay <- wday(data$ParsedDate, label=TRUE)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
#data$weekDay <- revalue(data$weekDay, c("mi\\."="Miercoles", "ju\\."="Jueves", "vi\\."="Viernes", "do\\."="Domingo", "lu\\."="Lunes", "ma\\."="Martes"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
#Cargamos los datos:
data <- read.csv("data.csv")
class(data$InvoiceDate)
#A priori parace que solo tenemos problemas con la fecha de la factura que es leída como un string
data <- data %>%
mutate(
ParsedDate = parse_datetime(InvoiceDate, format = "%m/%d/%Y %H:%M")
)
#Comprobamos que no haya NA en el fichero
anyNA(data) #Tenemos NA
summary(data) #Solo hay NA's en CustomerID
#Borramos todos los precios y cantidades negativas
data <- data %>%
mutate(Quantity = replace(Quantity, Quantity<=0, NA),
UnitPrice = replace(UnitPrice, UnitPrice<=0, NA))
#Borramos los NA
data <- data %>%
drop_na()
#Sustituimos los NA por 0, son 135080 observaciones que pueden contener información interesante
#data$CustomerID <- ifelse(is.na(data$CustomerID)== TRUE,0,data$CustomerID)
#Si hay duplicados los eliminamos con la función de dplyr
data <- data %>%
distinct()
#Añadimos una columna con el precio total de cada venta:
data <- data %>% mutate(lineTotal = Quantity * UnitPrice)
#Añadimos una columna con el dia de la semana
data$weekDay <- wday(data$ParsedDate, label=TRUE)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
#data$weekDay <- revalue(data$weekDay, c("mi\\."="Miercoles", "ju\\."="Jueves", "vi\\."="Viernes", "do\\."="Domingo", "lu\\."="Lunes", "ma\\."="Martes"))
data %>%
group_by(StockCode) %>%
summarise(count = n(),
sum_quantity = sum(Quantity),
mean_quantity = round(mean(Quantity), 2),
median_quantity = median(Quantity),
mode_quantity = unique(Quantity)[which.max(tabulate(match(Quantity, unique(Quantity))))],
sd_quantity = round(sd(Quantity), 2))
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
group_by(StockCode) %>%
summarise(Total = sum(Quantity))
#Ordenamos de mayor a menor
sales <- sales[
with(sales, order(-Total)),
]
sales %>% top_n(10) %>%
ggplot(aes(x = StockCode, y = Total)) +
geom_col() +
labs(x = 'Código Stock', y = 'Cantidad', title = 'Cantidad vendida de los top 10')
#Tenemos muchos productos que se han vendido solo una vez
sum(sales$Total == 1) #En concreto 52
#Quizás lo mejor sería eliminar estos productos del Stock
data$weekDay <- wday(data$ParsedDate, label=TRUE)
data %>%
group_by(weekDay) %>%
summarise(revenue = sum(lineTotal)) %>%
ggplot(aes(x = weekDay, y = revenue)) + geom_col() + labs(x = 'Dia de la semana', y = 'Beneficio (£)', title = 'Beneficio por dia de la semana')
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
data$weekDay <- revalue(data$weekDay, c("mi\\."="Miercoles", "ju\\."="Jueves", "vi\\."="Viernes", "do\\."="Domingo", "lu\\."="Lunes", "ma\\."="Martes"))
levels(data$weekDay)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
levels(data$weekDay) <- c("Dom","Lun","Mar","Mie","Jue","Vie","Sab")
data %>%
group_by(StockCode) %>%
summarise(count = n(),
sum_quantity = sum(Quantity),
mean_quantity = round(mean(Quantity), 2),
median_quantity = median(Quantity),
mode_quantity = unique(Quantity)[which.max(tabulate(match(Quantity, unique(Quantity))))],
sd_quantity = round(sd(Quantity), 2))
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
group_by(StockCode) %>%
summarise(Total = sum(Quantity))
#Ordenamos de mayor a menor
sales <- sales[
with(sales, order(-Total)),
]
sales %>% top_n(10) %>%
ggplot(aes(x = StockCode, y = Total)) +
geom_col() +
labs(x = 'Código Stock', y = 'Cantidad', title = 'Cantidad vendida de los top 10')
#Tenemos muchos productos que se han vendido solo una vez
sum(sales$Total == 1) #En concreto 52
#Quizás lo mejor sería eliminar estos productos del Stock
data$weekDay <- wday(data$ParsedDate, label=TRUE)
data %>%
group_by(weekDay) %>%
summarise(revenue = sum(lineTotal)) %>%
ggplot(aes(x = weekDay, y = revenue)) + geom_col() + labs(x = 'Dia de la semana', y = 'Beneficio (£)', title = 'Beneficio por dia de la semana')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
#Cargamos los datos:
data <- read.csv("data.csv")
class(data$InvoiceDate)
#A priori parace que solo tenemos problemas con la fecha de la factura que es leída como un string
data <- data %>%
mutate(
ParsedDate = parse_datetime(InvoiceDate, format = "%m/%d/%Y %H:%M")
)
#Comprobamos que no haya NA en el fichero
anyNA(data) #Tenemos NA
summary(data) #Solo hay NA's en CustomerID
#Borramos todos los precios y cantidades negativas
data <- data %>%
mutate(Quantity = replace(Quantity, Quantity<=0, NA),
UnitPrice = replace(UnitPrice, UnitPrice<=0, NA))
#Borramos los NA
data <- data %>%
drop_na()
#Sustituimos los NA por 0, son 135080 observaciones que pueden contener información interesante
#data$CustomerID <- ifelse(is.na(data$CustomerID)== TRUE,0,data$CustomerID)
#Si hay duplicados los eliminamos con la función de dplyr
data <- data %>%
distinct()
#Añadimos una columna con el precio total de cada venta:
data <- data %>% mutate(lineTotal = Quantity * UnitPrice)
#Añadimos una columna con el dia de la semana
data$weekDay <- wday(data$ParsedDate, label=TRUE)
#Como la etiquetas que genera automáticamente son horribles vamos a usar una funcion de plyr
levels(data$weekDay) <- c("Dom","Lun","Mar","Mie","Jue","Vie","Sab")
data %>%
group_by(StockCode) %>%
summarise(count = n(),
sum_quantity = sum(Quantity),
mean_quantity = round(mean(Quantity), 2),
median_quantity = median(Quantity),
mode_quantity = unique(Quantity)[which.max(tabulate(match(Quantity, unique(Quantity))))],
sd_quantity = round(sd(Quantity), 2))
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
group_by(StockCode) %>%
summarise(Total = sum(Quantity))
#Ordenamos de mayor a menor
sales <- sales[
with(sales, order(-Total)),
]
sales %>% top_n(10) %>%
ggplot(aes(x = StockCode, y = Total)) +
geom_col() +
labs(x = 'Código Stock', y = 'Cantidad', title = 'Cantidad vendida de los top 10')
#Tenemos muchos productos que se han vendido solo una vez
sum(sales$Total == 1) #En concreto 52
#Quizás lo mejor sería eliminar estos productos del Stock
data %>%
group_by(weekDay) %>%
summarise(revenue = sum(lineTotal)) %>%
ggplot(aes(x = weekDay, y = revenue)) + geom_col() + labs(x = 'Dia de la semana', y = 'Beneficio (£)', title = 'Beneficio por dia de la semana')
View(data)
View(data)
#Añadimos una columna con el dia del año
data$day <- day(data$ParsedDate, label=TRUE)
#Añadimos una columna con el dia del año
data$day <- day(data$ParsedDate)
#Añadimos una columna con el mes del año
data$month <- month(data$ParsedDate)
data %>%
group_by(month) %>%
summarise(revenue = sum(lineTotal)) %>%
ggplot(aes(x = month, y = revenue)) + geom_col() + labs(x = 'Mes', y = 'Beneficio (£)', title = 'Beneficio por mes')
class(data$month)
#Añadimos una columna con el mes del año
data$month <- month(data$ParsedDate, label = TRUE)
data %>%
group_by(month) %>%
summarise(revenue = sum(lineTotal)) %>%
ggplot(aes(x = month, y = revenue)) + geom_col() + labs(x = 'Mes', y = 'Beneficio (£)', title = 'Beneficio por mes')
class(data$month)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
#Cargamos los datos:
data <- read.csv("data.csv")
class(data$InvoiceDate)
#A priori parace que solo tenemos problemas con la fecha de la factura que es leída como un string
data <- data %>%
mutate(
ParsedDate = parse_datetime(InvoiceDate, format = "%m/%d/%Y %H:%M")
)
#Comprobamos que no haya NA en el fichero
anyNA(data) #Tenemos NA
summary(data) #Solo hay NA's en CustomerID
#Borramos todos los precios y cantidades negativas
data <- data %>%
mutate(Quantity = replace(Quantity, Quantity<=0, NA),
UnitPrice = replace(UnitPrice, UnitPrice<=0, NA))
#Borramos los NA
data <- data %>%
drop_na()
#Sustituimos los NA por 0, son 135080 observaciones que pueden contener información interesante
#data$CustomerID <- ifelse(is.na(data$CustomerID)== TRUE,0,data$CustomerID)
#Si hay duplicados los eliminamos con la función de dplyr
data <- data %>%
distinct()
#Añadimos una columna con el precio total de cada venta:
data <- data %>% mutate(lineTotal = Quantity * UnitPrice)
#Añadimos una columna con el dia de la semana
data$weekDay <- wday(data$ParsedDate, label=TRUE)
#Como la etiquetas que genera automáticamente son horribles vamos a renombrarlas
levels(data$weekDay) <- c("Dom","Lun","Mar","Mie","Jue","Vie","Sab")
#Añadimos una columna con el mes del año
data$month <- month(data$ParsedDate, label = TRUE)
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
group_by(StockCode) %>%
summarise(Total = sum(Quantity))
View(sales)
View(sales)
View(sales)
View(sales)
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
group_by(StockCode, UnitPrice) %>%
summarise(Total = sum(Quantity))
#Detalle importante a tener en cuenta: El precio de los productos son menores si se compran en grandes cantidades:
data %>%
group_by(StockCode, UnitPrice)
#Detalle importante a tener en cuenta: El precio de los productos son menores si se compran en grandes cantidades:
data %>%
group_by(StockCode, UnitPrice) %>% head(10)
#Detalle importante a tener en cuenta: El precio de los productos son menores si se compran en grandes cantidades:
data %>%
group_by(StockCode, UnitPrice) %>%
summarise(Total = sum(Quantity)) %>% head(10)
#Observamos la cantidad total vendida de cada producto
sales <- data %>%
group_by(StockCode) %>%
summarise(Total = sum(Quantity))
sales %>% top_n(10) %>% table()
sales %>% top_n(10)
sales %>% top_n(10) %>%
formattable(align = c("l", "c"),
list(Total = color_tile("#FF7F7F", "#71CA97"),
Total = color_bar("lightgrey"),),
col.names = c("Código","Nº Vendido"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(formattable)
sales %>% top_n(10) %>%
formattable(align = c("l", "c"),
list(Total = color_tile("#FF7F7F", "#71CA97"),
Total = color_bar("lightgrey"),),
col.names = c("Código","Nº Vendido"))
sales %>% top_n(10) %>%
formattable(align = c("l", "c"),
list(Total = color_tile("#FF7F7F", "#71CA97"),
Total = color_bar("lightgrey")),
col.names = c("Código","Nº Vendido"))
sales %>% top_n(10) %>%
formattable(align = c("l", "c"),
list(Total = color_tile("#FF7F7F", "#71CA97")),
col.names = c("Código","Nº Vendido"))
sales %>% top_n(10) %>%
formattable(align = c("l", "c"),
list(Total = color_bar("lightgrey")),
col.names = c("Código","Nº Vendido"))
#Tenemos muchos productos que se han vendido solo una vez
sum(sales$Total > 10) #En concreto 52
#Quizás lo mejor sería eliminar estos productos del Stock
sales$Total > 10
#Quizás lo mejor sería eliminar estos productos del Stock
sales[sales$Total > 10]
#Quizás lo mejor sería eliminar estos productos del Stock
sales[sales$Total > 10,]
#Quizás lo mejor sería eliminar estos productos del Stock
sales[sales$Total < 10,]
#Tenemos muchos productos que se han vendido menos de 10 veces
sum(sales$Total < 10) #En concreto 3306
#Quizás lo mejor sería eliminar estos productos del Stock
sales[sales$Total < 10,]
#Total de productos vendidos, total clientes, total dinero ganado, facturas y paises
data %>% select(InvoiceNo, StockCode, Quantity, CustomerID, Country, lineTotal)
#Total de productos vendidos, total clientes, total dinero ganado, facturas y paises
data %>%
select(InvoiceNo, StockCode, Quantity, CustomerID, Country, lineTotal) %>%
summarise(Invoices = unique(InvoiceNo),
Stock = unique(StockCode),
Customers = sum(Quantity),
Countries = unique(Country),
Revenue = sum(lineTotal))
#Total de productos vendidos, total clientes, total dinero ganado, facturas y paises
data %>%
select(InvoiceNo, StockCode, Quantity, CustomerID, Country, lineTotal) %>%
group_by(StockCode) %>%
summarise(Invoices = unique(InvoiceNo),
Stock = unique(StockCode),
Customers = sum(Quantity),
Countries = unique(Country),
Revenue = sum(lineTotal))
data %>%
select(InvoiceNo, StockCode, Quantity, CustomerID, Country, lineTotal) %>%
group_by(StockCode)
data %>%
select(Quantity,lineTotal) %>%
rowSums()
data %>%
select(Quantity,lineTotal) %>%
colSums()
sums <- data %>%
select(Quantity,lineTotal) %>%
colSums()
unic <- data %>%
select(InvoiceNo, StockCode, CustomerID, Country) %>%
unic <- data %>%
select(InvoiceNo, StockCode, CustomerID, Country)
unic <- data %>% select(InvoiceNo, StockCode, CustomerID, Country)
View(unic)
View(unic)
unic <- data %>% select(InvoiceNo, StockCode, CustomerID, Country) %>% unique()
unic <- data %>% select(InvoiceNo, StockCode, CustomerID, Country) #%>% unique()
unic <- data %>% select(InvoiceNo, StockCode, CustomerID, Country) %>% unique()
unic <- data %>% select(InvoiceNo, StockCode, CustomerID, Country) %>% distinct()
unic <- data %>% select(InvoiceNo, StockCode, CustomerID, Country) %>% summarise_all(n_distinct)
View(unic)
View(unic)
sums <- data %>%
select(Quantity,lineTotal) %>%
colSums()
sums <- data %>%
select(Quantity,lineTotal) %>%
summarise_all(sum)
View(sums)
View(sums)
sums <- data %>%
select(Quantity,lineTotal) %>%
colSums()
sums
sums <- data %>%
select(Quantity,lineTotal) %>%
summarise_all(sum)
View(sums)
View(sums)
totalStats <- merge(sums,unic)
View(totalStats)
View(totalStats)
totalStats <- t(merge(sums,unic))
View(totalStats)
View(totalStats)
table(totalStats)
totalStats
formattable(totalStats, align = c("l", "c"),
list(Total = color_bar("lightgrey")),
col.names = c("Código","Nº Vendido"))
formattable(totalStats, align = c("l", "c"),
list(Total = color_bar("lightgrey")),
col.names = c("Código","Nº Vendido"))
View(totalStats)
totalStats <- merge(sums,unic)
formattable(totalStats, align = c("l", "c"),
list(Total = color_bar("lightgrey")),
col.names = c("Código","Nº Vendido"))
View(totalStats)
View(totalStats)
totalStats
totalStats %>% formattable()
totalStats %>% formattable(col.names = c("Volumen ventas","Beneficio obtenido", "Facturas emitidas","Nº de productos en Stock", "Clientes únicos", "Paises"))
totalStats %>% formattable(align = c("c", "c", "c", "c", "c", "c"),
col.names = c("Volumen ventas","Beneficio obtenido", "Facturas emitidas","Nº de productos en Stock", "Clientes únicos", "Paises"))
