#Ejercicio 1
# a) log_llegadasi = b0 + b1 unescoi + ei

datos <-  read.csv("Datos Turismo.csv", sep = ";")
attach(datos)
fit1 <- lm(log_llegadas ~ unesco)
fit1 #El coeficiente tiene el signo esperado (Positivo)
summary(fit1)

# b) ¿El numero de lugares patrimonio de la Humanidad afecta el turismo?
#P valor de unesco es muy pequeño por tanto se RH0 tanto al 10% como al 1% de significación

# c) Haz un intervalo de confianza del 90% para el coeficiente de unesco
confint(fit1, level = 0.9)[,2]

# d) Prediccion puntual y por intervalo 95% para log_llegadas cuando unesco = 30
new.x <- data.frame(unesco = 30)
predict(fit1, newdata = new.x) #Prediccion puntual
predict(fit1, newdata = new.x, interval ="prediction") #Prediccion por intervalo

# e) Prediccion puntual y por intervalo 95% para el log_llegadas de la observacion 87
new.x <- data.frame(unesco = unesco[87])
predict(fit1, newdata = new.x, interval = "prediction") #Puntual y por intervalo

# f) Repita el apartado anterior, pero utilizando el nivel de confianza 99%
predict(fit1, newdata = new.x, interval = "prediction", level = 0.99)

#Ejercicio 2

library(wooldridge)
data("nbasal")
attach(nbasal)

# a) points = B0+ B1*exper+  B2*exper^2 + B3*age + B4*coll
fit2 = lm(points ~ exper + expersq + age + coll)
fit2 # points = 35.22 + 2.36*exper -0.08expersq -1.07age -1.29coll
summary(fit2) #SE      (0.41)        (0.02)        (0.30)  (0.45)

# b) Manteniendose constantes los años en la universidad (coll) y la edad (age), 
# ¿a que valor de la experiencia un año adicional de esta reduce los puntos por partido? 
# ¿Es esto razonable?
# 0 = 35.22 + 2.36*exper - 0.08expersq #Resolvemos la ecuación de segundo grado
# A partir de 40,4 años la experiencia empieza a reducir los puntos por partido
# No es razonable, nadie tiene una carrera de 40 años en el baloncesto

# c) ¿Por que crees que coll tiene un coeficiente negativo y estadisticamente significativo?
# Porque si van a la universidad, no pueden dedicar todo su tiempo al basquet y por ello no
# alcanzan su potencial máximo

# d) Agregue a la ecuacion un termino cuadratico en age:
fit3 = lm(points ~ exper + expersq + age+ I(age^2) + coll)
summary(fit3)
#¿Es necesario ese termino?
anova(fit2,fit3)
#No RH0 por tanto nos quedamos con el modelo restringido

#¿Que parece implicar este termino acerca de los efectos de age, 
# una vez controladas la experiencia y educacion?
#El efecto del efecto de los años es positivo.

# e) Regresion log(wage) sobre points, exper, exper^2, age y coll
fit4 = lm(log(wage) ~ points + exper + expersq + age + coll)
summary(fit4)
#log(wage) = 6.78 + 0.08*points + 0.22*exper - 0.01*expersq - 0.05*age - 0.04*coll
#SE         (0.85)    (0.01)      (0.05)       (0.01)         (0.03)     (0.05)

# f) Contrasta si age y coll son conjuntamente significativas al 5% de significacion.
fit5 = lm(log(wage) ~ points + exper + expersq)
anova(fit5,fit4)
#No RH0 por tanto nos quedamos con el modelo restringido
#No tienen efecto separados???

# Ejercicio 3

# a) points = B0 + B1*exper + B3*expersq + B4*center + B5*forward #guard default
fit6 = lm(points ~ exper + expersq + center + forward)
summary(fit6)
#points = 7.08 + 1.28exper - 0.07expersq - 2.32center - 0.77forward
#SE       (1.02) (0.33)      (0.02)        (1.00)       (0.76)

# b) Puntua 2.31 menos un "center" que un "guard" 0.02 < 0.05 es significativo al 5%

# c) Ahora agregue el estado civil (marr = 1 si es casado) a la regresion
fit7 = lm(points ~ exper + expersq + center + forward + marr)
summary(fit7)
#¿son mas productivos los jugadores casados (segun los puntos por partido)?
#No es significativo

# d) Agregue interacciones del estado civil con las dos variables de experiencia al modelo de regresion
fit8 = lm(points ~ exper + expersq + center + forward + marr + I(marr*exper) + I(marr*expersq))
summary(fit8)
#¿hay una fuerte evidencia de que el estado civil tenga algun efecto sobre los puntos por partido?
anova(fit7,fit8)
#No RH0, nos quedamos con el modelo restringido

# e) Estime el modelo del apartado c. pero use las asistencias por partido (assists) como variable dependiente.
fit9 = lm(assists ~ exper + expersq + center + forward + marr)
summary(fit9)
#Los signos de las estimaciones se mantienen pero si que ha aumentado la significacion de la variables explicativas
# aunque marr sigue siendo no significativa

# Ejercicio 4
library(wooldridge)
data("wage2")
attach(wage2)
# a) log(wage) = β0 + β1educ + β2exper + β3tenure + β4married + β5black + β6south + β7urban + e
fit10 = lm(lwage ~ educ + exper + tenure + married + black + south + urban)
summary(fit10)
#log(wage) = 5.40 + 0.07educ + 0.01exper + 0.01tenure + 0.20married - 0.19black - 0.09south + 0.18urban
#SE                 (0.01)    (0.00)      (0.00)        (0.04)        (0.04)      (0.03)        (0.03)
# ¿cual es la diferencia aproximada entre el salario mensual de solteros y casados?
# Log lineal por tanto: 0.199417*100% = 19.9% más si esta casado que soltero.
#¿Es esta diferencia estad´ısticamente significativa al 5% de significacion?
#Si, ya que p valor de married 0.00 < 0.05 por tanto es significativa al 5%

# b) Agregue a esta ecuacion las variables exper^2 y tenure^2 y muestre que no son conjuntamente significativas
# al nivel del 10% de significacion
fit11 = lm(lwage ~ educ + exper + tenure + married + black + south + urban + I(exper^2) + I(tenure^2))
summary(fit11)
anova(fit10,fit11)
#No RH0 al 10% de significación (0.226), nos quedamos con el modelo restringido.

# c) Amplie el modelo original de manera que el rendimiento a la educacion dependa de la raza y contrasta si en
# realidad el rendimiento de la educacion depende de la raza
fit12 = lm(lwage ~ educ + exper + tenure + married + black + south + urban + I(educ*black))
summary(fit12)
#No es significativo

# d) Partiendo nuevamente del modelo original, permita que los salarios difieran entre cuatro grupos: casados
# negros, casados no negros, solteros negros y solteros no negros.
#Referencia: blanco soltero
fit13 = lm(lwage ~ educ + exper + tenure + married + black + south + urban + I(married*black))
summary(fit13)
# ¿Cual es la diferencia de salario estimada entre negros solteros y no negros solteros?
#Log lineal: los negros casados cobran un 6,13% más que los solteros pero no es significativo.

#Ejercicio 5

library(wooldridge)
data("sleep75")
attach(sleep75)

# a) Estime el modelo abajo por separado para hombres y mujeres y presente los resultados de la regresion con
# los errores est´andares de los coeficientes estimados
# sleep = β0 + β1totwrk + β2educ + β3age + β4age^2 + β5yngkid + e

fit14 = lm(sleep ~ totwrk + educ + age + agesq + yngkid)
summary(fit14)
#sleep = 3825.37 -0.15totwrk - 11.14educ - 8.12age + 0.13age^2 + 17.15yngkid
#SE     (240,26)   (0.02)        (5.89)      (11.37)   (0.14)      (50.01)

# b) Haz un contraste conjunto de la igualdad entre los parametros para hombres y mujeres
#Referencia: mujer
fit15 = lm(sleep ~ totwrk + educ + age + agesq + yngkid + male)
summary(fit15)
anova(fit14,fit15)
#Se RH0, nos quedamos con el modelo no restringido pvalor: 0.011<0.05 Es significativo al 5%

# c) Ahora considera interceptos diferentes entre hombres y mujeres y determine si los terminos de interaccion
#en los que pone male son conjuntamente significativos al 5% de significacion
fit16 = lm(sleep ~ totwrk + educ + age + agesq + yngkid + male + I(totwrk*male) + I(educ*male) + I(age*male) + I(agesq*male) + I(yngkid*male))
summary(fit16)
anova(fit14,fit16)
#Se RH0, nos quedamos con el modelo no restringido, pvalor 0.04949 < 0.05 significativo al 5%

# d) Dados los resultados de los apartados b. y c. anteriores, ¿cual es el modelo final?
anova(fit15,fit16)
#No RH0 (0.2814), nos quedamos con el modelo restringido (Modelo de b)